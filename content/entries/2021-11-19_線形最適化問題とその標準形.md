+++
title = "線形最適化問題とその標準形"
slug = "CmH78Gpk"
+++

## まえがき

ブログに {{ katex(source = "\KaTeX") }} を導入して、数式が書けるようになりました！せっかくなので何か数式を使った記事を書きたいなーと思ってネタを考えていたのですが、そういえば最近大学で、**線形最適化問題**をコンピューターで解く方法の一つであるシンプレックス法について教わったので、理解した内容を自分なりにまとめてみようと思います。

この記事では次の２つの事項を扱います。

- **線形最適化問題とは何か**
- **線形最適化問題の標準形と標準形への変換方法**

線形最適化問題の具体的な解き方やシンプレックス法については、後日別の記事で扱います。

誤りなどがあれば [Twitter@ihoronir](https://twitter.com/ihoronir) へお問い合わせいただけると助かります。

## 最適化問題とは何か
そもそも「最適化問題」とは、**目的関数**の値が最大、もしくは最小になるような**実行可能解**、つまり**最適解**を求める問題のことを言います。いきなり聞いたこともないような言葉がたくさん出てきてびっくりしますが、例を使って説明します。

### 目的関数と決定変数

あなたは大学生で、明日テストがあります。しかし、全然勉強していません。今の時刻は午後10時です。

さて、明日のテストに向けて今から勉強をしなければなりません。しかし、何時まで勉強すれば明日のテストで最も良い点数が取れるでしょうか。

あんまり早く勉強を切り上げて寝てしまえば、十分な勉強量が確保できず、良い点数はとれなさそうですね。一方で、日が昇る前まで寝ずに勉強した場合、勉強量は確保できても睡眠時間が足らず、眠気のせいで集中してテストを受けることができないかもしれません。このように明日のテストの点数は、今から何時間勉強するかで決まります。

この状況は、**テストの点数は勉強時間の関数である**というふうに見ることができます。勉強時間が短すぎても長すぎてもテストの点数は低くなります。ちょうど良い勉強時間のときにテストの点数は最も高くなります。

ここで、次のように定義します。
 
- {{ katex(source = "x") }} ：勉強時間
- {{ katex(source = "f(x)") }} ：テストの点数

今求めたいのはテストの点数が最大になる勉強時間です。つまり、我々の目的は {{ katex(source = "f(x)") }} が最大になる {{ katex(source = "x") }} の値を決定することです。

このとき、 {{ katex(source = "f(x)") }} が**目的関数**、 {{ katex(source = "x") }} が**決定変数**になります。

### 制約条件と実行可能解・最適解

最適化問題によっては、決定変数の取りうる値の範囲が制約されている場合があります。先程の例では勉強時間が負になることはなく、テスト開始時刻を超えて勉強することもできません。つまり、決定変数 {{ katex(source = "x") }} は、テスト開時刻までの時間を {{ katex(source = "b") }} として、 {{ katex(source = "0 < x < b")}} を満たします。このような、決定変数が取りうる値を制約する条件を、**制約条件**と呼び、制約条件を満たす決定変数の値を**実行可能解**と呼びます。 

**実行可能解**の中で、目的関数の値が最大、もしくは最小になるときの決定変数の値が、求めたい**最適解**です。

### 最適化問題の表現

先程の例の最適化問題は、次のように表されます。

{% katex(block = true) %}
\begin{split}
    \text{max}  \space\space\space & f(x) \\
    \text{s.t.} \space\space\space & 0 < x < b
\end{split}
{% end %}

{{ katex(source = "\text{max}") }} は後ろに続く目的関数が最大となるときが最適解である（最大化問題）ということを表しています。目的関数が最小となるときが最適解である場合（最小化問題）は {{ katex(source = "\text{min}") }} と書きます。 {{ katex(source = "\text{s.t.}") }} は {{ katex(source = "\text{subject to}") }} の略で、後ろに続く式が制約条件を表しているという意味です。

## 線形最適化問題とは何か

最適化問題のうち、目的関数と制約条件式が決定変数の１次結合で表されるものを、**線形最適化問題**と呼びます。世の中の様々な最適化問題が線形最適化問題としてモデル化できるということが知られています。また、線形最適化問題はシンプレックス法を用いてコンピューターで高速に（有限時間内で）解くことができます。

### 線形最適化問題の例

ある牧場では、牛と豚を飼っています。

- 牛を１頭出荷すると {{ katex(source = "7") }} の利益が得られ、豚を１匹出荷すると {{ katex(source = "4") }} の利益が得られます。
- 牛を１頭育てて出荷するには {{ katex(source = "5") }} の飼料が必要で、豚を１匹育てて出荷するには {{ katex(source = "3") }} の飼料が必要です。
- 年間に最大で {{ katex(source = "20") }} の飼料を使うことができます。
- 牛を１頭育てて出荷するには {{ katex(source = "9") }} の水が必要で、豚を１匹育てて出荷するには {{ katex(source = "7") }} の水が必要です。
- 年間に最大で {{ katex(source = "30") }} の水を使うことができます。

このとき、年間の利益を最大にするには１年間に何頭の牛と豚を出荷すれば良いでしょうか？１

この問題を最適化問題と見て、一年間に出荷する牛の頭数を {{ katex(source = "x_1") }} 、豚の匹数を {{ katex(source = "x_2") }} とすると、次のように表されます。 

{% katex(block = true) %}
\begin{split}
    \text{max}  \space\space\space & 7x_1 + 4x_2         \\
    \text{s.t.} \space\space\space & 5x_1 + 3x_2 \leq 20 \\
                                   & 9x_1 + 7x_2 \leq 30 \\
                                   & x_j \geq 0\space\space\space (j = 1, 2)
\end{split}
{% end %}

目的関数と制約条件式が決定変数の１次結合で表されているので、この最適化問題は線形最適化問題です。

## 線形最適化問題の標準形

線形最適化問題には**標準形**というものがあります。標準形は解く方法が分かっており、標準形でない問題も標準形に変換することで解くことができます。

線形最適化問題の標準形は次にように表されます。


{% katex(block = true) %}
\begin{split}
    \text{min}  \space\space\space &    c_1x_1 +    c_2x_2 + \cdots +    c_nx_n       \\
    \text{s.t.} \space\space\space & a_{11}x_1 + a_{12}x_2 + \cdots + a_{1n}x_n = b_1 \\
                                   & a_{21}x_1 + a_{22}x_2 + \cdots + a_{2n}x_n = b_2 \\
                                   & \space \vdots                                    \\
                                   & a_{m1}x_1 + a_{m2}x_2 + \cdots + a_{mn}x_n = b_m \\
                                   & x_j \geq 0 \space\space\space (j = 1, 2, \dots, n)
\end{split}
{% end %}

行列を用いて次のように表すこともできます。

{% katex(block = true) %}
\begin{split}
    \text{min}  \space\space\space & \bm{c^\top} \bm{x} \\
    \text{s.t.} \space\space\space & A \bm{x} = \bm{b}  \\
                                   & \bm{x} \geq \bm{o}
\end{split}
{% end %}

{% katex(block = true) %}
\bm{c} =
\begin{bmatrix}
    c_1    \\
    c_2    \\
    \vdots \\
    c_n    \\
\end{bmatrix}, \space

\bm{x} =
\begin{bmatrix}
    x_1    \\
    x_2    \\
    \vdots \\
    x_n    \\
\end{bmatrix},\space

A=
\begin{bmatrix}
    a_{11} & a_{12} & \cdots & a_{1n} \\
    a_{21} & a_{22} & \cdots & a_{2n} \\
    \vdots & \vdots & \ddots & \vdots \\
    a_{m1} & a_{m2} & \cdots & a_{mn} \\
\end{bmatrix},\space

\bm{b}=\begin{bmatrix}
    b_1    \\
    b_2    \\
    \vdots \\
    b_m    \\
\end{bmatrix}
{% end %}

{{ katex(source = "\bm{x} \geq \bm{o}") }} は {{ katex(source = "\bm{x}") }} の全ての成分が {{ katex(source = "\bm{o}") }} （零行列）の対応する成分以上であること、すなわち {{ katex(source = "\bm{x}") }} の成分が全て {{ katex(source = "0") }} 以上であることを表します。また、 {{ katex(source = "\bm{c^\top}") }} は {{ katex(source = "\bm{c}") }} の転置行列です。

### 標準形への変換

標準形でない線形最適化問題は以下の手順で標準形に変換することができます。この手順で変換して得られる標準形の最適解は、もとの問題の最適解と同じになります。（※決定変数を置き換えた部分は逆算してもとの問題の決定変数を求める必要があることに注意。）

#### 1. 最大化問題になっているとき

目的関数を {{ katex(source = "-1") }} 倍して、 {{ katex(source = "\text{max}") }} を {{ katex(source = "\text{min}") }} に変えます。
つまり、 {{ katex(source = "\text{max} \space c_1x_1 + c_2x_2 + \cdots + c_nx_n") }} となっているところを、 {{ katex(source = "\text{min} \space - c_1x_1 - c_2x_2 - \cdots - c_nx_n") }} に変更します。

目的関数を {{ katex(source = "-1") }} 倍することで最大化問題を最小化問題に変換しているというわけです。

#### 2. {{ katex(source = "a_{i1}x_1 + a_{i2}x_2 + \cdots + a_{in}x_n \leq b_i \space (i = 1, 2, \dots)") }} の制約条件式があるとき

新たな決定変数、例えば {{ katex(source = "x_{n+1}") }} を追加して、 {{ katex(source = "a_{i1}x_1 + a_{i2}x_2 + \cdots + a_{in}x_n + x_{n+1} = b_i \space (i = 1, 2, \dots)") }} に変更し、 {{ katex(source="x_{n+1} \geq 0") }} の制約条件式を追加します。

新たな決定変数を追加し、制約条件式の左辺と右辺の差を埋めています。

#### 3. {{ katex(source = "a_{i1}x_1 + a_{i2}x_2 + \cdots + a_{in}x_n \geq b_1 \space (i = 1, 2, \dots)") }} の制約条件式があるとき

新たな決定変数、例えば {{ katex(source = "x_{n+1}") }} を追加して、 {{ katex(source = "a_{i1}x_1 + a_{i2}x_2 + \cdots + a_{in}x_n-x_{n+1} = b_i \space (i = 1, 2, \dots)") }} に変更し、 {{ katex(source="x_{n+1} \geq 0") }} の制約条件式を追加します。

先程と {{ katex(source="x_{n+1}") }} の符号が逆になっていることに注意です。 

#### 4. {{ katex(source = "x_j \geq 0") }} の制約条件がないとき

新たな決定変数、例えば {{ katex(source = "x_{n+1}, x_{n+2}") }} を追加して、 {{ katex(source = "x_j = x_{n+1} - x_{n+2}") }} というふうに置き換えます。また、 {{ katex(source="x_{n+1}, x_{n+2} \geq 0") }} の制約条件式を追加します。

このように負の値をとり得る決定変数がある場合も、２つの正の決定変数の差に置き換えることで標準形へ変換できます。

#### 5. {{ katex(source = "x_j \leq 0") }} の制約条件があるとき

新たな決定変数、例えば {{ katex(source = "x_{n+1}") }} を追加して、 {{ katex(source = "x_j = - x_{n+1}") }} というふうに置き換え、 {{ katex(source="x_{n+1} \geq 0") }} の制約条件式を追加します。

### 標準形への変換の例

次の線形最適化問題の標準形への変換を考えます。

{% katex(block = true) %}
\begin{split}
    \text{max}  \space\space\space & 4x_1        + 3x_3        \\
    \text{s.t.} \space\space\space &  x_1 + 2x_2        \geq 9 \\
                                   & 4x_1        -5x_3  \leq 8 \\
                                   &  x_j \geq 0 \space\space\space (j = 1, 3)
\end{split}
{% end %}

まずは最小化問題に変換します。

{% katex(block = true) %}
\begin{split}
    \text{min}  \space\space\space & - 4x_1        - 3x_3        \\
    \text{s.t.} \space\space\space &    x_1 + 2x_2        \geq 9 \\
                                   &   4x_1        - 5x_3 \leq 8 \\
                                   & x_j \geq 0 \space\space\space (j = 1, 3)
\end{split}
{% end %}

次に、決定変数 {{ katex(source = "x_{4},x_{5}") }} を追加して以下の形に変換します。

{% katex(block = true) %}
\begin{split}
    \text{min}  \space\space\space & - 4x_1        - 3x_3                   \\
    \text{s.t.} \space\space\space &    x_1 + 2x_2        - x_4         = 9 \\
                                   &   4x_1        - 5x_3         + x_5 = 8 \\
                                   & x_j \geq 0 \space\space\space (j = 1, 3, 4, 5)
\end{split}
{% end %}

決定変数 {{ katex(source = "x_{6},x_{7}") }} を追加し、 {{ katex(source = "x_2 = x_6-x_7") }} というふうに置き換えます。

{% katex(block = true) %}
\begin{split}
    \text{min}  \space\space\space & - 4x_1                 -3x_3                 \\
    \text{s.t.} \space\space\space &    x_1 + 2(x_6 - x_7)        - x_4       = 9 \\
                                   &   4x_1                 -5x_3       + x_5 = 8 \\
                                   & x_j \geq 0 \space\space\space (j = 1, 3, 4, 5, 6, 7)
\end{split}
{% end %}

整理すると次のような標準形が得られます。

{% katex(block = true) %}
\begin{split}
    \text{min}  \space\space\space & - 4x_1 - 3x_3                               \\
    \text{s.t.} \space\space\space &    x_1        - x_4       + 2x_6 - 2x_7 = 9 \\
                                   &   4x_1 - 5x_3       + x_5               = 8 \\
                                   & x_j \geq 0 \space\space\space (j = 1, 3, 4, 5, 6, 7)
\end{split}
{% end %}

必要に応じて文字を置き換えると見やすくなります。

{% katex(block = true) %}
\begin{split}
    \text{min}  \space\space\space & - 4y_1 - 3y_2                                 \\
    \text{s.t.} \space\space\space &    y_1        - y_3         + 2y_5 - 2y_6 = 9 \\
                                   &   4y_1 - 5y_2       + y_4                 = 8 \\
                                   & y_j \geq 0 \space\space\space (j = 1, 2, \dots, 6)
\end{split}
{% end %}

文字を置き換えた後の問題の最適解 {{ katex(source = "y_1, y_2 \dots y_6") }} に対して、もとの問題の最適解 {{ katex(source = "x_1, x_2, x_3") }} は次のように求められます。

- {{ katex(source = "x_1 = y_1") }}
- {{ katex(source = "x_2 = x_6 - x_7 = y_5 - y_6") }} 
- {{ katex(source = "x_3 = y_2") }}

## まとめ

- **最適化問題**は**目的関数**が最大または最小になるような**実行可能解**を求める問題である。
- 目的関数の値は**決定変数**により決まる。
- 実行可能解とは**制約条件**を満たすような決定変数のことである。
- 目的関数と制約条件式が決定変数の１次結合で表される最適化問題を、**線形最適化問題**と呼ぶ。
- **標準形**でない線形最適化問題は標準形に変換することができる。
- 線形最適化問題の標準形は、コンピューターで有限時間内に解くことができる。

## あとがき

書くのがめちゃめちゃ大変でした。特に {{ katex(source = "\KaTeX") }} で数式を書くのが難しかったです。 {{ katex(source = "\KaTeX") }} を使いこなすにはまだまだ修行が必要そうです。

続編は気長にお待ちください。
